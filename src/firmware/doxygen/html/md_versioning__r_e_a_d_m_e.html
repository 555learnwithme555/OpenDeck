<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenDeck: Software versioning for AVR</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenDeck
   </div>
   <div id="projectbrief">DIY MIDI platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_versioning__r_e_a_d_m_e.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Software versioning for AVR </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module consists of two parts:</p>
<p>1) C executable responsible for writing software version into compiled .BIN file (major, minor and revision point), as well as writing 7-byte hash and CRC of compiled binary.</p>
<p>2) AVR module used to read written sofware version, hash and CRC from running application.</p>
<h2>C executable</h2>
<p>In order for this utility to work correctly, five files are needed:</p>
<ul>
<li><code>FLASH.bin</code></li>
<li><code>MAJOR</code></li>
<li><code>MINOR</code></li>
<li><code>REVISION</code></li>
<li><code>HASH</code></li>
</ul>
<p>All files must be placed in <code>bin</code> directory.</p>
<p><code>MAJOR</code>, <code>MINOR</code> and <code>REVISION</code> files should contain single number representing software version point (max value of 65535). <code>HASH</code> file should contain 7-byte long hash, such as:</p>
<p><code>01b5b2f</code></p>
<p>To calculate location at which version and hash are going to be written, the following formula is used: <code>FLASH_SIZE - 6 - 7 - 2</code></p>
<p><code>FLASH_SIZE</code> is determined by checking file size of supplied <code>FLASH.bin</code> file. After that, 6 bytes are subtracted since there are three version points, each taking two bytes. After that, 7 bytes are subtracted since hash contains 7 bytes. Finally, two bytes are subtracted, since CRC requires two bytes.</p>
<p>After software version and hash have been written to binary, application calculates CRC of entire binary and writes it to last two memory addresses.</p>
<h2>AVR module</h2>
<p>To use AVR module for reading out software version and hash from running application, several symbols need to be supplied.</p>
<h3><code>FLASH_SIZE</code></h3>
<p>Size of running application in bytes. For instance, if flash size is 32kb, use the following symbol:</p>
<ul>
<li><code>FLASH_SIZE=32768</code></li>
</ul>
<h3><code>EEPROM_SIZE</code></h3>
<p>Size of EEPROM on AVR in bytes. For instance, if EEPROM size is 1kb, use the following symbol:</p>
<ul>
<li><code>EEPROM_SIZE=1024</code></li>
</ul>
<p>Module reads software version and hash directly from running binary. Module can also detect if firmware has been updated by comparing CRC written in running binary with CRC written to specified EEPROM address. If two differ, <code>checkNewRevision</code> function will return true, or false otherwise. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Nov 25 2017 21:29:37 for OpenDeck by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
